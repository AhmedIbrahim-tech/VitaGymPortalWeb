@using Core.Modules.Trainers.ViewModels
@model IEnumerable<TrainerViewModel>

<partial name="_AlertMessages" />

<partial name="_PageHeader" model="@((string)null)" />

@if (Model != null && Model.Any())
{
	<div class="card">
		<div class="card-body p-0">
			<div class="table-responsive">
				<table class="table datatable" id="trainersTable">
					<thead class="thead-light">
						<tr>
							<th class="no-sort">
								<label class="checkboxs">
									<input type="checkbox" id="select-all">
									<span class="checkmarks"></span>
								</label>
							</th>
							<th class="d-none d-lg-table-cell">Photo</th>
							<th>Name</th>
							<th class="d-none d-md-table-cell">Email</th>
							<th class="d-none d-lg-table-cell">Gender</th>
							<th>Phone</th>
							<th>Specialization</th>
							<th>Status</th>
							<th class="no-sort"></th>
						</tr>
					</thead>
					<tbody>
						@foreach (var trainer in Model)
						{
							<tr>
								<td>
									<label class="checkboxs">
										<input type="checkbox">
										<span class="checkmarks"></span>
									</label>
								</td>
								<td class="d-none d-lg-table-cell">
									@if (trainer.Photo != null)
									{
										<img src="~/images/trainers/@trainer.Photo" alt="@trainer.Name" class="rounded-circle shadow-sm" width="45" height="45" />
									}
									else
									{
										<img src="~/images/user.png" alt="@trainer.Name" class="rounded-circle shadow-sm" width="45" height="45" />
									}
								</td>
								<td>@trainer.Name</td>
								<td class="d-none d-md-table-cell">@trainer.Email</td>
								<td class="d-none d-lg-table-cell">@trainer.Gender</td>
								<td>@trainer.Phone</td>
								<td>
									@if (!string.IsNullOrEmpty(trainer.specialization) && trainer.specialization != "N/A")
									{
										var specializations = trainer.specialization.Split(',');
										@foreach (var spec in specializations)
										{
											<span class="badge bg-primary-subtle text-primary-emphasis rounded-pill px-3 py-1 me-1">@spec.Trim()</span>
										}
									}
									else
									{
										<span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill px-3 py-1">N/A</span>
									}
								</td>
								<td>
									@if (trainer.IsActive)
									{
										<span class="d-inline-flex align-items-center p-1 pe-2 rounded-1 text-white bg-success fs-10">
											<i class="ti ti-point-filled me-1 fs-11"></i>Active
										</span>
									}
									else
									{
										<span class="d-inline-flex align-items-center p-1 pe-2 rounded-1 text-white bg-danger fs-10">
											<i class="ti ti-point-filled me-1 fs-11"></i>Inactive
										</span>
									}
								</td>
								<td class="action-table-data">
									<div class="edit-delete-action">
										<a asp-controller="Trainer" asp-action="TrainerDetails" asp-route-Id="@trainer.Id" class="btn btn-icon btn-soft-info rounded-pill" title="View Details">
											<i data-feather="eye" class="feather-edit"></i>
										</a>
										<a asp-controller="Trainer" asp-action="TrainerEdit" asp-route-Id="@trainer.Id" class="btn btn-icon btn-soft-success rounded-pill" title="Edit">
											<i data-feather="edit" class="feather-edit"></i>
										</a>
										<form asp-controller="Trainer" asp-action="ToggleStatus" asp-route-id="@trainer.Id" method="post" class="d-inline">
											<button type="submit" class="btn btn-icon @(trainer.IsActive ? "btn-soft-info" : "btn-soft-success") rounded-pill" title="@(trainer.IsActive ? "Deactivate" : "Activate")">
												<i data-feather="@(trainer.IsActive ? "x-circle" : "check-circle")" class="feather-edit"></i>
											</button>
										</form>
										<button type="button" 
												class="btn btn-icon btn-soft-danger rounded-pill" 
												title="Delete"
												data-bs-toggle="modal" 
												data-bs-target="#deleteModal_@trainer.Id">
												<i data-feather="trash-2" class="feather-trash-2"></i>
											</button>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
}
else
{
	<partial name="_EmptyState" />
}

@foreach (var trainer in Model)
{
	var modalId = "deleteModal_" + trainer.Id;
	var message = "Are you sure you want to delete the trainer '" + trainer.Name + "'? This action cannot be undone.";
	
	var deleteModalViewData = new ViewDataDictionary(ViewData);
	deleteModalViewData["DeleteUrl"] = Url.Action("Delete", "Trainer");
	deleteModalViewData["ModalId"] = modalId;
	deleteModalViewData["Title"] = "Delete Trainer";
	deleteModalViewData["Message"] = message;
	deleteModalViewData["EntityId"] = trainer.Id;
	
	<partial name="_DeleteModal" view-data="deleteModalViewData" />
}

@section Scripts {
	<partial name="_AlertBoxScript" />
	<script>
		$(document).ready(function () {
			if (feather) {
				feather.replace();
			}

			// Check if DataTable is already initialized and destroy it first
			if ($.fn.DataTable.isDataTable('#trainersTable')) {
				$('#trainersTable').DataTable().destroy();
			}

			// Initialize DataTable
			var table = $('#trainersTable').DataTable({
				"bFilter": true,
				"sDom": 'fBtlpi',
				"ordering": true,
				"language": {
					search: ' ',
					sLengthMenu: '_MENU_',
					searchPlaceholder: "Search",
					sLengthMenu: 'Row Per Page _MENU_ Entries',
					info: "_START_ - _END_ of _TOTAL_ items",
					paginate: {
						next: ' <i class=" fa fa-angle-right"></i>',
						previous: '<i class="fa fa-angle-left"></i> '
					},
				},
			});
		});
	</script>
}