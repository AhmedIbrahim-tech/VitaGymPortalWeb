@using Core.ViewModels.MemberViewModels
@model MemberToUpdateViewModel
@{
	ViewData["Title"] = "Edit Member";
}

<div class="container mb-5">
	<div class="row justify-content-center">
		<div class="col-lg-8">
			<div class="card shadow-lg border-primary rounded-4">
				<div class="card-body p-4 p-md-5">
					<div class="text-center mb-4">
						@if(Model.Photo != null)
						{
							<img src="~/images/members/@Model.Photo" alt="@Model.Name" class="rounded-circle border border-3 border-primary shadow-sm"
								 style="width: 120px; height: 120px; object-fit: cover;" />
						}
						else
						{
							<img src="~/images/user.png" alt="@Model.Name" class="rounded-circle border border-3 border-primary shadow-sm"
								 style="width: 120px; height: 120px; object-fit: cover;" />
						}
						<h3 class="mt-3 mb-1 text-primary">@Model.Name</h3>
						<p class="text-muted">Edit member information</p>
					</div>
					<form asp-controller="Member" asp-action="MemberEdit" method="post" enctype="multipart/form-data" novalidate>
						<input asp-for="Photo" type="hidden" />
						<input asp-for="Name" type="hidden" />

						<div class="row g-3">
							<div class="col-12">
								<label asp-for="PhotoFile" class="form-label fw-semibold">Profile Photo</label>
								<div class="mb-2">
									<img id="photoPreview" src="@(Model.Photo != null ? $"~/images/members/{Model.Photo}" : "~/images/user.png")" 
										 alt="Photo Preview" 
										 style="max-width: 150px; max-height: 150px;" 
										 class="rounded-circle border border-2 border-primary" />
								</div>
								<input asp-for="PhotoFile" type="file" class="form-control" accept="image/*" id="photoInput"/>
								<span asp-validation-for="PhotoFile" class="text-danger"></span>
								<small class="form-text text-muted">Max size: 5 MB. Allowed types: JPG, PNG, JPEG. Leave empty to keep current photo.</small>
							</div>
							<div class="col-12">
								<label asp-for="Email" class="form-label fw-semibold">Email Address <span class="text-danger">*</span></label>
								<input asp-for="Email" class="form-control" />
								<span asp-validation-for="Email" class="text-danger"></span>
							</div>
							<div class="col-md-6">
								<label asp-for="Phone" class="form-label fw-semibold">Phone <span class="text-danger">*</span></label>
								<input asp-for="Phone" class="form-control" />
								<span asp-validation-for="Phone" class="text-danger"></span>
							</div>
							<div class="col-md-6">
								<label asp-for="BuildingNumber" class="form-label fw-semibold">Building Number</label>
								<input asp-for="BuildingNumber" class="form-control" />
								<span asp-validation-for="BuildingNumber" class="text-danger"></span>
							</div>
							<div class="col-md-6">
								<label asp-for="City" class="form-label fw-semibold">City <span class="text-danger">*</span></label>
								<input asp-for="City" class="form-control" />
								<span asp-validation-for="City" class="text-danger"></span>
							</div>
							<div class="col-md-6">
								<label asp-for="Street" class="form-label fw-semibold">Street <span class="text-danger">*</span></label>
								<input asp-for="Street" class="form-control" />
								<span asp-validation-for="Street" class="text-danger"></span>
							</div>
						</div>

						<div class="d-flex justify-content-between gap-3 border-top pt-4 mt-4">
							<a asp-controller="Member" asp-action="Index" class="btn btn-outline-secondary d-flex align-items-center gap-2">
								<i class="bi bi-arrow-left"></i> Back to List
							</a>
							<button type="submit" class="btn btn-primary d-flex align-items-center gap-2">
								<i class="bi bi-check-lg"></i> Update Member
							</button>
						</div>
						</form>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>

@section Scripts{
	<partial name="_ValidationScriptsPartial"/>
	<script>
		// Preview photo before upload
		document.getElementById('photoInput')?.addEventListener('change', function(e) {
			var file = e.target.files[0];
			if (file) {
				var reader = new FileReader();
				reader.onload = function(e) {
					var preview = document.getElementById('photoPreview');
					preview.src = e.target.result;
					preview.style.display = 'block';
				}
				reader.readAsDataURL(file);
			}
		});
	</script>
}
